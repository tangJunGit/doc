<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="#"> 
	<title>柱形图</title>
	<style type="text/css">
		svg.histogram{
			background: #eee; 
		}
		.histogram .axis path,
		.histogram .axis line{
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}
		.histogram .axis text {
			font-family: sans-serif;
			font-size: 11px;
		}
		.histogram .axis.x .axislabel{
			text-anchor: start;
		}
		.histogram .axis.y .axislabel{
			text-anchor: middle;
		}
		.histogram .rect {
			fill: steelblue;
		}
		.histogram .text {
			fill: white;
			text-anchor: middle;
		}

	</style>
</head>
<body>

<svg class="histogram" width="400" height="400"></svg>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript">
	// 获取画布信息
	var svg = d3.select('.histogram');
	var width = svg.attr('width');
	var height = svg.attr('height');
	var padding = {left: 40, right: 40, top: 30, bottom: 30};	// svg padding

	// 定义数据
	var dataset = [
					{id: 1, name: '一班',　score: 87},
					{id: 2, name: '二班',　score: 67},
					{id: 3, name: '三班',　score: 95},
					{id: 4, name: '四班',　score: 81},
					{id: 5, name: '五班',　score: 77},
				  ];
    var scores = dataset.map(function(d){return d.score});
    var classNames = dataset.map(function(d){return d.name});

    // 定义比例尺
	var xScale = d3.scale.ordinal()
					.domain(d3.range(dataset.length))
					.rangeRoundBands([0, width - padding.left - padding.right]);
	var yScale = d3.scale.linear()
					.domain([0, d3.max(scores)])
					.range([height - padding.top - padding.bottom, 0]);

	// 定义坐标轴
	var xAxis = d3.svg.axis()
					.scale(xScale)
					.tickFormat(function(d, i) {         // 格式化横坐标
						return classNames[i];
					})
					.orient('bottom');
	var yAxis = d3.svg.axis()
					.scale(yScale)
					.ticks(10)
					.orient('left');

	// 添加矩形
	var rectPadding = 8;   			// 矩形空白间隔
	var rects = svg.selectAll('.rect')
					.data(scores)
					.enter()
					.append('rect')
					.attr('class', 'rect')
					.attr('transform', 'translate('+padding.left+', '+padding.top+')')
					.attr('x', function(d, i){
						return xScale(i) + rectPadding/2;
					})
					.attr('y', function(d, i){
						return yScale(d);
					})
					.attr('width', xScale.rangeBand() - rectPadding)
					.attr('height', function(d){
						return height - yScale(d) - padding.top - padding.bottom;
					});

	// 添加文字
	var texts = svg.selectAll('.text')
					.data(scores)
					.enter()
					.append('text')
					.attr('class', 'text')
					.attr('transform', 'translate('+padding.left+', '+padding.top+')')
					.attr('x', function(d, i){
						return xScale(i) + rectPadding/2;
					})
					.attr('y', function(d){
						return yScale(d);
					})
					.attr('dx', function(){
						return (xScale.rangeBand() - rectPadding)/2;
					})
					.attr('dy', function(d){
						return 20;
					})
					.text(function(d){
						return d;
					});

	// 添加坐标轴
	svg.append('g')
		.attr('class', 'axis x')
		.attr('transform', 'translate('+padding.left+', '+(height - padding.bottom)+')')
		.call(xAxis);
	svg.append('g')
		.attr('class', 'axis y')
		.attr('transform', 'translate('+padding.left+', '+padding.top+')')
		.call(yAxis);
	svg.select('g.axis.x')
		.append("text")  
        .attr("class", "axislabel")  
        .attr("x", width - padding.left - padding.right + 5)  
        .attr("y", 5)  
        .text("班级");
    svg.select('g.axis.y')
		.append("text")  
        .attr("class", "axislabel")  
        .attr("x", 0)  
        .attr("y", -5)  
        .text("平均成绩");
</script>
</body>
</html>